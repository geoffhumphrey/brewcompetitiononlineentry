$(document).ready(function () {

    // Persistent/sticky nav scroll offset
    var topoffset = 60;

    // Check initial scroll position on page load
    var initialScrollTop = $(window).scrollTop();

    // Invoke TomSelect for some select form elements
    document.querySelectorAll('.bootstrap-select').forEach((el) => {
        let settings = {
            maxOptions: 1000,
            allowEmptyOption: false
        };
        new TomSelect(el, settings);
    });
    
    // Enable Bootstrap Tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
    
    // Enable Bootstrap Popovers
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)
    });

    // Single Page Nav Elements
    $('.navbar a[href*=\\#]:not([href=\\#])').click(function () {
        
        if (location.pathname.replace(/^\//, '') === this.pathname.replace(/^\//, '') && location.hostname === this.hostname) {
            
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top - topoffset + 2
                }, 500);
                return false;
            }
        }
    
    });

    $('.modal-body a[href*=\\#]:not([href=\\#])').click(function () {
        
        if (location.pathname.replace(/^\//, '') === this.pathname.replace(/^\//, '') && location.hostname === this.hostname) {
            
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            
            if (target.length) {
                $('.modal').modal('hide');
                $('html,body').animate({
                    scrollTop: target.offset().top - topoffset + 2
                }, 500);
                return false;
            }

        }
    });

    $('.contains-link a[href*=\\#]:not([href=\\#])').click(function () {
        
        if (location.pathname.replace(/^\//, '') === this.pathname.replace(/^\//, '') && location.hostname === this.hostname) {
            
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top - topoffset + 2
                }, 500);
                return false;
            }

        }
    
    });

    if (section == "default") {

        // Show Scroll to Top button on ScrollSpy
        // Only for home page
        $(window).on('activate.bs.scrollspy', function () {
            
            var hash = $('.site-nav').find('a.active').attr('href');

            if (hash === '#home') {
                $('#sticky-home').fadeOut(500);
            }
        
        });
        
        if (initialScrollTop < 200) {
            
            $("#scroll-indicator").fadeIn(500);
            $("#sticky-home").fadeOut(500);

        } else {

           $("#scroll-indicator").fadeOut(500);
           $("#sticky-home").fadeIn(500);

        }

        // Handle scroll events
        $(window).scroll(function() {
            
            var scrollTop = $(this).scrollTop();
            
            if (scrollTop > 200) {
                // Hide the scroll indicator when scrolled more than 200px
                $("#scroll-indicator").fadeOut(500);
                $("#sticky-home").fadeIn(500);
            
            } else {
                // Show the scroll indicator when within 200px of the top
                $("#scroll-indicator").fadeIn(500);
                $("#sticky-home").fadeOut(500);
            }

        });

    } else {

        // Other pages, show/hide Scroll to Top button
        $(window).scroll(function() {
            
            var scrollTop = $(this).scrollTop();
            
            if (scrollTop > 200) {
                // Hide the scroll indicator when scrolled more than 200px
                $("#scroll-indicator").fadeOut(500);
                $("#sticky-home").fadeIn(500);
            
            } else {
                // Show the scroll indicator when within 200px of the top
                $("#scroll-indicator").fadeIn(500);
                $("#sticky-home").fadeOut(500);
            }

        });

        $('#sticky-home').click(function () {
            $('html, body').animate({ 
                scrollTop: target.offset().top - topoffset + 2
            }, 500);
        });

    }

    // Invoke animateCSS
    const animateCSS = (element, animation, prefix = 'animate__') => new Promise((resolve, reject) => {
        
        const animationName = `${prefix}${animation}`;
        const node = document.querySelector(element);
        node.classList.add(`${prefix}animated`, animationName);
            
        function handleAnimationEnd(event) {
            event.stopPropagation();
            node.classList.remove(`${prefix}animated`, animationName);
                resolve('Animation ended');
            }
        
        node.addEventListener('animationend', handleAnimationEnd, {once: true});
    
    });

}); // end (document).ready

// Bootstrap Form Validation
(() => {
    
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    
    Array.from(forms).forEach(form => {
        
        form.addEventListener('submit', event => {
            
            if (!form.checkValidity()) {
                
                document.getElementById('loader-submit').style.display = 'none';
                event.preventDefault();
                event.stopPropagation();
                $("#form-submit-button-disabled-msg-required").modal('show');
            
            } else {
                document.getElementById('loader-submit').style.display = 'block';
            }

            form.classList.add('was-validated');

        }, false)
    });

})();